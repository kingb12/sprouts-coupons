SPROUTS COUPONS - STATUS REPORT
================================
Generated: 2026-01-31

SUMMARY
-------
All core functionality is working. 10/10 integration tests pass.
The clip_coupon method remains stubbed as requested.

WHAT'S WORKING
--------------

1. HEADLESS LOGIN (session.py)
   Status: WORKING
   - Firefox browser launches in headless mode
   - Cookie consent dialog dismissed ("REJECT COOKIES")
   - Shop mode confirmation dismissed ("Confirm")
   - Sign in flow completes via account.sprouts.com
   - Session cookies extracted for API use
   - Tested: test_headless_login_succeeds, test_session_has_required_cookies

2. COUPON API (client.py)
   Status: WORKING
   - GraphQL API at shop.sprouts.com/graphql responds with 200
   - Authenticated requests return full offer data
   - Offers correctly parsed into Offer objects
   - Currently seeing 32 offers in your account
   - Tested: test_api_with_auth_cookies_returns_offers, test_offers_have_expected_fields

3. API AUTHENTICATION
   Status: VERIFIED
   - Without auth cookies: API returns generic/public offers (not user-specific)
   - With auth cookies: API returns personalized offers with clip status
   - The API doesn't reject unauthenticated requests, but returns different data
   - User-specific offer state (clipped vs available) requires authentication
   - Tested: test_api_without_auth_cookies_fails

4. OFFER LOGGING (main.py)
   Status: WORKING
   - Each offer logged with INFO level
   - Format: [CLIPPED/AVAILABLE] Name - Description (expires: date)
   - Summary logged at end (32 clipped, 0 available)

5. CLIP COUPON STUB (client.py)
   Status: STUBBED (as requested)
   - Method exists and accepts Offer + SessionInfo
   - Returns True and logs "[STUB] Clipping coupon: {name}"
   - Ready for actual implementation when needed
   - Tested: test_clip_coupon_stub_returns_true

6. EMAIL REPORTS (email.py)
   Status: WORKING
   - Uses sendmail at /usr/sbin/sendmail (optional)
   - Email addresses read from environment variables:
     - SPROUTS_EMAIL_SENDER
     - SPROUTS_EMAIL_RECIPIENT
   - If not set, logs warning and writes report to logs/reports.log instead
   - Subject: "Sprouts coupons: {count} clipped"
   - Report includes offer summary and clipped coupon list
   - Tested: test_build_report, test_log_report, test_send_real_email

7. FILE LOGGING (main.py)
   Status: WORKING
   - All logs written to logs/sprouts_coupons.log
   - Reports written to separate logs/reports.log
   - Log directory configurable via SPROUTS_LOG_DIR env var
   - Console output mirrors file logs

8. FULL FLOW (main.py)
   Status: WORKING
   - CLI entry point: `sprouts-coupons`
   - Options: --headless/--no-headless, --dry-run, --skip-clip, -v
   - Complete flow: login -> fetch offers -> log -> clip -> report
   - Tested: test_full_flow


WHAT NEEDS WORK
---------------

1. CLIP COUPON IMPLEMENTATION
   Issue: Currently stubbed, doesn't actually clip
   Location: client.py:clip_coupon()
   Notes: Needs GraphQL mutation for actual clipping. All your coupons
          are already clipped (32 clipped, 0 available), so this is fine
          for now.


TEST RESULTS
------------
$ pytest src/sprouts_coupons/test_integration.py -v -m integration

TestLogin::test_headless_login_succeeds .............. PASSED
TestLogin::test_session_has_required_cookies ......... PASSED
TestCouponAPI::test_api_with_auth_cookies_returns_offers ... PASSED
TestCouponAPI::test_api_without_auth_cookies_fails ... PASSED
TestCouponAPI::test_offers_have_expected_fields ...... PASSED
TestClipCoupon::test_clip_coupon_stub_returns_true ... PASSED
TestEmailReport::test_build_report ................... PASSED
TestEmailReport::test_log_report ..................... PASSED
TestEmailReport::test_send_real_email ................ PASSED
TestFullFlow::test_full_flow ......................... PASSED

============================= 10 passed ==============================


RECOMMENDATIONS
---------------
1. Run daily with: `sprouts-coupons --headless`
2. For testing: `sprouts-coupons --dry-run` (no email sent)
3. To just view offers: `sprouts-coupons --skip-clip --dry-run`
4. If clip implementation needed, inspect network traffic when manually
   clipping a coupon to find the GraphQL mutation
